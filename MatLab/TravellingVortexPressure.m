N = 1000;

rho0 = 0.5;

r   = linspace(0.0,1,N);
dr  = 1.0/(N-1);
p   = 0.0*r;
pth = p;

gamma = 1.4;
Gamma = (gamma-1) / gamma;

coe = [1.0/12.0, -12.0/13.0, 9.0/2.0, -184.0/15.0, 609.0/32.0, ...
       - 222.0/17.0, -38.0/9.0, 54.0/19.0, 783.0/20.0, -558.0/7.0, ...
       1053.0/22.0, 1014.0/23.0, -1473.0/16.0, 204.0/5.0, 510.0/13.0, ...
       -1564.0/27.0, 153.0/8.0, 450.0/29.0, -269.0/15.0, ... % K.etal 259; Papke 269 
       174.0 / 31.0, 57.0/32.0, -74.0/33.0, 15.0/17.0, -6.0/35.0, ...
       1.0/72.0]*1024*1024*Gamma;



rho  =@(x) rho0 + 0.5*(1-x.^2).^6;
dpdr =@(x) Gamma * 1024*1024*(rho0 + 0.5*(1-x.^2).^6) .* (1-x).^12 .* x.^11;
%dpdr =@(x) Gamma * (rho0 + 0.0*(1-x.^2).^6) .* (1-x).^12 .* x.^11;
uth  =@(x) 1024*(1-x).^6 .* x.^6;

p(1)   = 0.0;
pth(1) = 0.0;
for k = 2:N
    p(k) = p(k-1) + 0.5*dr*(dpdr(r(k-1)) + dpdr(r(k)));
    pth(k) = 0.0;
    for ll = 1:25
        pth(k) = pth(k) + coe(ll)*(r(k)^(11+ll) - 1.0);
    end
end

% =====================================================================
% Display
% =====================================================================

figure(50)
plot(r,p-p(N))
title('exner pressure')
hold
plot(r,pth, 'r--')
axis tight;

figure(51)
plot(r,(p-p(N))/Gamma)
title('pressure')
hold
plot(r,pth/Gamma, 'r--')
axis tight;

figure(52)
plot(r,uth(r))
title('u_{\theta}')

figure(53)
plot(r,rho(r))
title('\rho')
