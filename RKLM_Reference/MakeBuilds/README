=======
README
=======

Readme file to setup, run and post-process output for the RKLM_Reference code.

=======
1) Upon cloning the repository, generate the running output folders 

../../low_mach_gravity_{comp, psinc} 

by running 

chmod +x create_lm_comp_psinc_dirs.sh 
source create_lm_comp_psinc_dirs.sh

=======
2) In order to store the output for a preset series of test cases, the additional folder 

../../hdf_output

can be created by modifying the script create_dirs.sh and running

chmod +x create_dirs.sh
source create_dirs.sh

=======
3) The subdirectories of ../../hdf_output can be cleaned by running

chmod +x clean_hdf_output_test.sh
source clean_hdf_output_test.sh TEST

where TEST is one of the test cases set in 2).

=======
4) Include the location of the HDF libraries in your system in ../Management/io.c

This is currently handled by the preprocessor flag {RUPERT, TOMMASO}

Example change:

#sed -i "s|//\ #define\ TOMMASO|#define\ TOMMASO|g" ../Common.h
#sed -i "s|#define\ RUPERT|//#define\ RUPERT|g" ../Common.h

=======
5) To run a test of the form ../Input/userdata_TEST.c, within the RKLM_Reference/MakeBuilds type:

chmod +x run_test.sh
source run_test.sh TEST

This does the following:

- Cleans the running folders low_mach_gravity_{comp,psinc}
for output and cleans the output folder for the particular
test via clean_hdf_output.sh;

- Changes the test-case dependent instances in the Makefiles
using the script changetest.sh;

- Changes the output folder to the one relative to the user;

- Compiles and runs the code; copies the output from the running folders
low_mach_gravity_{comp, psinc} to the case-dependent ones in the hdf_output
subfolder;

=======
6) In order to run the suite of tests for the paper "A semi-implicit compressible
model for atmospheric flows with seamless access to soundproof and hydrostatic dynamics", run:

chmod +x run_suite.sh
source run_suite.sh

This also plots the results by calling the related matlab script make_plots.m. 
WARNING: this currently assumes that (a) matlab is installed and callable
from command line; (b) the tests in the matlab script are the same ones 
that are run in run_suite.sh - currently this can be achieved by uncommenting
the relevant tests in make_plots.m.

=======
SUMMARY 
=======

In order to download and run the code and plot results, after checking
the dependencies, please execute the following:

git clone https://git.imp.fu-berlin.de/rupert/RKLM_Reference.git
cd RKLM_Reference
git checkout TB_RKLMCRC1114_A02
cd RKLM_Reference/MakeBuilds
source create_lm_comp_psinc_dirs.sh 
source create_dirs.sh 
source run_suite.sh








